!function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=25)}([function(e,r){e.exports=require("babel-runtime/regenerator")},function(e,r){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,r){e.exports=require("mongoose")},function(e,r,t){"use strict";t.d(r,"a",function(){return u});var n=t(2),a=n.Schema.ObjectId,o=new n.Schema({_id:{type:a,auto:!0},firstName:String,lastName:String,mail:String,password:String,picture:String,birthedAt:String,createdAt:String,role:String,books:[{type:a,ref:"Book"}]}),u=Object(n.model)("User",o)},function(e,r,t){"use strict";t.d(r,"a",function(){return u});var n=t(2),a=n.Schema.ObjectId,o=new n.Schema({_id:{type:a,auto:!0},title:String,content:String,author:{type:a,ref:"User"},category:{type:String,ref:"Category"}}),u=Object(n.model)("Book",o)},function(e,r){e.exports=require("jsonwebtoken")},function(e,r,t){"use strict";t.d(r,"a",function(){return u});var n=t(2),a=n.Schema.ObjectId,o=new n.Schema({_id:String,label:String,books:[{type:a,ref:"Book"}]}),u=Object(n.model)("Category",o)},function(e,r){e.exports=require("graphql-iso-date")},function(e,r){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,r){e.exports=require("babel-runtime/helpers/createClass")},function(e,r){e.exports=require("merge-graphql-schemas")},function(e,r){e.exports=require("graphql-tools")},function(e,r,t){"use strict";t.d(r,"b",function(){return u}),t.d(r,"a",function(){return i});var n=t(7),a=t(5),o=t(22),u={Date:n.GraphQLDate,Time:n.GraphQLTime,DateTime:n.GraphQLDateTime,Upload:o.GraphQLUpload},i={auth:function(e,r,t,n,o){var u=n.headers.authorization,i=t.role;if("ANONYMOUS"===i)return e();if(!u)throw"You must supply a JWT for authorization";try{n.tokenDecoded=a.verify(u.replace("Bearer ",""),process.env.JWT_SECRET)}catch(e){throw"Token is not valid"}switch(i){case"ADMIN":return e();default:if(i!==n.tokenDecoded.role)throw"You are not authorized to access at this resource";return e()}}}},function(e,r){e.exports=require("hapi")},function(e,r){e.exports=require("apollo-server-hapi")},function(e,r,t){"use strict";(function(e){t.d(r,"a",function(){return h});var n=t(16),a=t.n(n),o=t(17),u=t.n(o),i=t(10),c=t(18),s=t(19),p=t(20),f=(t(23),t(12)),l=(t(7),t(5),t(24),t(11)),d={typeDefs:Object(i.mergeTypes)(Object(i.fileLoader)(u.a.join(e,"./types")),{all:!0}),resolvers:Object(i.mergeResolvers)([].concat(a()(f.b),[c.a,s.a,p.a])),directiveResolvers:f.a},h=Object(l.makeExecutableSchema)(d)}).call(this,"src")},function(e,r){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,r){e.exports=require("path")},function(e,r,t){"use strict";var n,a,o=t(0),u=t.n(o),i=t(1),c=t.n(i),s=t(3),p=t(4);r.a={Query:{user:(a=c()(u.a.mark(function e(r,t){var n=t._id;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.findById(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),function(e,r){return a.apply(this,arguments)})},User:{books:(n=c()(u.a.mark(function e(r){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.find({author:r._id});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),function(e){return n.apply(this,arguments)})}}},function(e,r,t){"use strict";var n,a,o,u,i,c=t(0),s=t.n(c),p=t(1),f=t.n(p),l=t(4),d=t(3),h=t(6);r.a={Query:{books:(i=f()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.find();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),function(){return i.apply(this,arguments)}),book:(u=f()(s.a.mark(function e(r,t){var n=t._id;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.findById(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),function(e,r){return u.apply(this,arguments)})},Mutation:{createBook:(o=f()(s.a.mark(function e(r,t){var n=t.input;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.create(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),function(e,r){return o.apply(this,arguments)})},Book:{author:(a=f()(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.findById(r.author);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),function(e){return a.apply(this,arguments)}),category:(n=f()(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.findById(r.category);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),function(e){return n.apply(this,arguments)})}}},function(e,r,t){"use strict";var n,a,o,u,i=t(21),c=t.n(i),s=t(0),p=t.n(s),f=t(1),l=t.n(f),d=t(3),h=t(5),v=t.n(h);r.a={Query:{me:(u=l()(p.a.mark(function e(r,t,n){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.findById(n.tokenDecoded.userID);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),function(e,r,t){return u.apply(this,arguments)})},Mutation:{updatePictureMe:(o=l()(p.a.mark(function e(r,t){var n,a,o,u,i=t.file;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.findById(context.tokenDecoded.userID);case 2:return n=e.sent,e.next=5,i;case 5:return a=e.sent,o=a.filename,a.mimetype,u=a.createReadStream,u(),console.log(o),e.abrupt("return",n);case 12:case"end":return e.stop()}},e,void 0)})),function(e,r){return o.apply(this,arguments)}),login:(a=l()(p.a.mark(function e(r,t){var n,a=t.input;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.findOne({mail:a.mail,password:a.password});case 2:if(null!==(n=e.sent)){e.next=5;break}throw"E-mail ou mot de passe invalide !";case 5:return e.abrupt("return",{token:v.a.sign({userID:n._id,role:n.role},process.env.JWT_SECRET)});case 6:case"end":return e.stop()}},e,void 0)})),function(e,r){return a.apply(this,arguments)}),register:(n=l()(p.a.mark(function e(r,t){var n,a=t.input;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c()({},a,{createdAt:new Date,role:"USER"}),e.next=3,d.a.create(a);case 3:return n=e.sent,e.abrupt("return",{token:v.a.sign({userID:n._id,role:n.role},process.env.JWT_SECRET)});case 5:case"end":return e.stop()}},e,void 0)})),function(e,r){return n.apply(this,arguments)})}}},function(e,r){e.exports=require("babel-runtime/helpers/extends")},function(e,r){e.exports=require("apollo-server")},function(e,r,t){"use strict";var n,a,o,u,i=t(0),c=t.n(i),s=t(1),p=t.n(s),f=t(6),l=t(4);u=p()(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.find();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),o=p()(c.a.mark(function e(r,t){var n=t._id;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.findById(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),a=p()(c.a.mark(function e(r,t){var n=t.input;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.create(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)})),n=p()(c.a.mark(function e(r){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.find({category:r._id});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,void 0)}))},function(e,r){e.exports=require("graphql-middleware")},function(e,r,t){"use strict";t.r(r);var n=t(0),a=t.n(n),o=t(1),u=t.n(o),i=t(8),c=t.n(i),s=t(9),p=t.n(s),f=t(13),l=t(14),d=(t(11),t(15)),h=t(2),v=t.n(h);v.a.Types.ObjectId.prototype.valueOf=function(){return this.toString()};var b=function(){function e(){c()(this,e)}return p()(e,null,[{key:"init",value:function(){var r=u()(a.a.mark(function r(){return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,v.a.connect(e.path,{useNewUrlParser:!0});case 2:case"end":return r.stop()}},r,this)}));return function(){return r.apply(this,arguments)}}()}]),e}();b.path="mongodb://127.0.0.1:27017/api-interalivre";var m=function(){function e(){c()(this,e)}return p()(e,null,[{key:"init",value:function(){var r=u()(a.a.mark(function r(){var t,n,o=this;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,b.init();case 2:return t=new l.ApolloServer({schema:d.a,context:function(){var e=u()(a.a.mark(function e(r){var t=r.request;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}},e,o)}));return function(r){return e.apply(this,arguments)}}()}),n=new f.Server({host:e.host,port:e.port,routes:{cors:{origin:["*"],credentials:!0}}}),r.next=6,t.applyMiddleware({cors:!0,app:n});case 6:return r.next=8,t.installSubscriptionHandlers(n.listener);case 8:return r.next=10,n.start();case 10:console.log("Server connected at "+e.host+":"+e.port);case 11:case"end":return r.stop()}},r,this)}));return function(){return r.apply(this,arguments)}}()}]),e}();m.host="localhost",m.port=4e3,m.init().catch(function(e){return console.log(e)})}]);